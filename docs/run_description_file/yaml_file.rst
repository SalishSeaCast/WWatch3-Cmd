..  Copyright 2019, the MIDOSS project contributors, The University of British Columbia,
..  and Dalhousie University.
..
..  Licensed under the Apache License, Version 2.0 (the "License");
..  you may not use this file except in compliance with the License.
..  You may obtain a copy of the License at
..
..    https://www.apache.org/licenses/LICENSE-2.0
..
..  Unless required by applicable law or agreed to in writing, software
..  distributed under the License is distributed on an "AS IS" BASIS,
..  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
..  See the License for the specific language governing permissions and
..  limitations under the License.


.. _RunDescriptionFile:

***********************************
WaveWatch III® Run Description File
***********************************

.. _ExampleRunDescriptionYAML-File:

Example Run Description YAML File
=================================

.. literalinclude:: wwatch3.yaml.example
   :language: yaml


.. _BasicRunConfiguration:

Basic Run Configuration
=======================

The following key-value pairs provide the basic configuration for the run:

:kbd:`run_id`
   The job identifier that appears in the temporary run directory name and the :command:`squeue` command output.

:kbd:`email`
  The email address at which you want to receive notification of the beginning and end of execution of the run,
  as well as notification of abnormal abort messages.
  You can include multiple email addresses by separating them with commas.

:kbd:`account`
  The account name to include in the :kbd:`#SBATCH` directives section of the :file:`SoGWW3.sh` job script.
  This key-value pair is required on systems like :kbd:`cedar.computecanada.ca` and :kbd:`graham.computecanada.ca` that use the `Slurm Workload Manager`_ and that you submit runs to with the :command:`sbatch` command.

  .. _Slurm Workload Manager: https://slurm.schedmd.com/

Here is an example of the basic run configuration keys and values:

.. code-block:: yaml

    run_id: SoGwaves
    email: you@example.com
    account: def-allen


.. _PathsSection:

:kbd:`paths` Section
====================

The :kbd:`paths` section of the run description file is a collection of directory paths that :program:`wwatch3` uses to find directory paths that it needs.

Here is an example :kbd:`paths` section:

.. code-block:: yaml

    paths:
      runs directory: $SCRATCH/MIDOSS/wwatch3-runs/

:kbd:`runs directory`
  The path to the directory where temporary run directories will be created by the :command:`wwatch3 run` (or :command:`wwatch3 prepare`) sub-command.

  This path may be relative or absolute,
  but an absolute path is strongly recommended.
  It may contain:

  * :envvar:`$SCRATCH` as an alternative spelling of the user's :file:`scratch` directory on :kbd:`cedar`
  * :envvar:`$PROJECT` as an alternative spelling of the group's :file:`project` directory on :kbd:`cedar`
  * :envvar:`$USER` as an alternative spelling of the user's userid
  * :kbd:`~` or :envvar:`$HOME` as alternative spellings of the user's home directory

An error will be raised if :kbd:`runs directory` key is missing,
or if the path given does not exist.


.. _GridSection:

:kbd:`grid` Section
===================

The :kbd:`grid` section of the run description file provides the path of the :file:`mod_def.ww3` file generated by ww3_grid during the WaveWatch III® installation process:

Here is an example :kbd:`grid` section:

.. code-block:: yaml

    grid:
      mod_def.ww3 file: $PROJECT/$USER/MIDOSS/wwatch3-runs/mod_def.ww3

The path may be relative or absolute.
It may contain:

* :envvar:`$SCRATCH` as an alternative spelling of the user's :file:`scratch` directory on :kbd:`cedar`
* :envvar:`$PROJECT` as an alternative spelling of the group's :file:`project` directory on :kbd:`cedar`
* :envvar:`$USER` as an alternative spelling of the user's userid
* :kbd:`~` or :envvar:`$HOME` as alternative spellings of the user's home directory

An error will be raised if the :file:`mod_def.ww3` key is missing,
or if the file does not exist at the location given.


.. _ForcingSection:

:kbd:`forcing` Section
======================

The :kbd:`forcing` section of the run description file is a collection of directory paths that :program:`wwatch3` uses to find directory paths that it needs.

Here is an example :kbd:`forcing` section:

.. code-block:: yaml

    forcing:
      current: /scratch/dlatorne/MIDOSS/forcing/wwatch3/current/
      wind: /scratch/dlatorne/MIDOSS/forcing/wwatch3/wind/

:kbd:`current`
  The path to the directory where surface current forcing files generated by the :ref:`salishseanowcast:MakeWW3CurrentFile-Worker` are stored.

:kbd:`wind`
  The path to the directory where wind forcing files generated by the :ref:`salishseanowcast:MakeWW3WindFile-Worker` are stored.

The paths may be relative or absolute,
byt absolute paths are strongly recommended.
They may contain:

* :envvar:`$SCRATCH` as an alternative spelling of the user's :file:`scratch` directory on :kbd:`cedar`
* :envvar:`$PROJECT` as an alternative spelling of the group's :file:`project` directory on :kbd:`cedar`
* :envvar:`$USER` as an alternative spelling of the user's userid
* :kbd:`~` or :envvar:`$HOME` as alternative spellings of the user's home directory

If relative paths are given,
they are appended to the directory containing the run description file.

Errors will be raised if either the :kbd:`current` or :kbd:`wind` keys are missing,
or if the paths given do not exist.


.. _RestartSection:

:kbd:`restart` Section
======================

The *optional* :kbd:`restart` section of the run description file contain a key-value pair that the provide path and file name of the restart file to be used to initialize the run.

Here is an example :kbd:`restart` section:

.. code-block:: yaml

    restart:
      restart.ww3: /scratch/dlatorne/MIDOSS/forcing/wwatch3/01jan15/restart001.ww3

The path may be relative or absolute,
but an absolute path is strongly recommended.
It may contain:

* :envvar:`$SCRATCH` as an alternative spelling of the user's :file:`scratch` directory on :kbd:`cedar`
* :envvar:`$PROJECT` as an alternative spelling of the group's :file:`project` directory on :kbd:`cedar`
* :envvar:`$USER` as an alternative spelling of the user's userid
* :kbd:`~` or :envvar:`$HOME` as alternative spellings of the user's home directory

If a relative path is given,
it is appended to the directory containing the run description file.

The :kbd:`restart.ww3` key is the name that is used for the symbolic link that is created to the restart file path/name.
It is

WaveWatch III or requires that the name of the model restart file be :kbd:`restart.ww3`,
so that is the key that you must use.
A symbolic link called :kbd:`restart.ww3` is created to the value in the temporary run directory.

The :kbd:`restart` section is optional.
If no restart file is provided WaveWatch III® initializes itself with a quiescent wave field.
